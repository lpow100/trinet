name: Windows Network Test

on: [push, pull_request]

jobs:
  build-and-run:
    runs-on: windows-latest  # This is a real Windows VM!

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Compile with MinGW
        run: |
          gcc -o serverExample.exe src/serverExample.c src/windows.c src/common.c -I. -lws2_32

      - name: Test Server Startup
        run: |
          # Start the server in the background and wait 2 seconds
          Start-Process -FilePath "./serverExample.exe" -ArgumentList "8080"
          Start-Sleep -Seconds 2
          
          # Check if the process is still running (if it crashed, this fails)
          $proc = Get-Process -Name "serverExample" -ErrorAction SilentlyContinue
          if ($proc) {
              Write-Host "Server is running successfully!"
              Stop-Process -Name "serverExample"
          } else {
              Write-Error "Server crashed or failed to start!"
              exit 1
          }